<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titre de la page</title>
</head>
<body>

  <!-- https://francoisbonnisseau.github.io/chatbot/test_upload_file.html -->
    <h1>test12</h1>
    <!-- <input type="file"> -->
    <button id="myButton">Click Me!</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js.map"></script>
    <script src="https://cdn.botpress.cloud/webchat/v1/inject.js"></script>
<script src="https://mediafiles.botpress.cloud/a0558026-9a2d-4890-9eec-545d11e931ef/webchat/config.js" defer></script>
  <script>

    // function handleClick() {
    //   console.log('Button clicked!')
    //   window.botpressWebChat.sendPayload({
    //     type: 'trigger',
    //     payload: {
    //       myCustomProperty: 'hello',
    //     },
    //   })
    // }

    // const button = document.getElementById('myButton')
    // button.addEventListener('click', handleClick)

    // window.botpressWebChat.onEvent(
    //   function (event) {
    //     if (event.type === 'LIFECYCLE.LOADED') {
    //       window.botpressWebChat.sendEvent({ type: 'show' })
    //       window.botpressWebChat.sendPayload({
    //         type: 'trigger',
    //         payload: {
    //           myCustomProperty: 'test',
    //         },
    //       })
    //     }
    //   },
    //   ['LIFECYCLE.LOADED']
    // )

    window.botpressWebChat.onEvent(
      (event) => {
        if (event.type === 'MESSAGE.RECEIVED') {
          if(event.value.payload.type === 'text'){
            console.log('A new message was received! : ', event.value.payload.text)
            if(event.value.payload.text === 'Vous pouvez maintenant choisir un fichier'){
              //ouvrir la fenetre de selection de fichier et récupérer les informations du fichier
              const fileInput = document.createElement('input');
              fileInput.type = 'file';
              fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                console.log('Selected file:', file);
                const reader = new FileReader();
                reader.onload = async function(event) {
                  const fileContent = event.target.result;
                  const title = file.name;
                  console.log('Title:', title);
                  
                  //Traiter le cas où c'est un pdf
                  if (file.type === 'application/pdf') {
                    // Process PDF file
                    const pdfDoc = await PDFLib.PDFDocument.load(fileContent);
                    const pages = pdfDoc.getPages();
                    let pdfText = '';
                    for (const page of pages) {
                      pdfText += await page.getTextContent();
                    }
                    console.log('Content (PDF):', pdfText);
                  } else {
                    // Process text file
                    console.log('Content (Text):', fileContent);
                  }

                  console.log('Content:', fileContent);
                };
                reader.readAsText(file);
              });
              fileInput.click();
            }
          }
        }
      },
      ['MESSAGE.RECEIVED']
    )


  // window.botpressWebChat.onEvent(event => {
  //   alert('event');
  // },
  // ['TRIGGER'])
  
  // window.botpressWebChat.onEvent(
  //   (event) => {
  //     if (event.type === 'MESSAGE.SENT') {
  //       console.log('Message sent:')
  //     } else if (event.type === 'MESSAGE.RECEIVED') {
  //       console.log('Message received:')
  //     } else if (event.type === 'MESSAGE.SELECTED') {
  //       console.log('Message selected:')
  //     }
  //   },
  //   ['MESSAGE.SENT', 'MESSAGE.RECEIVED', 'MESSAGE.SELECTED']
  // )


  // function sendData(Name,Content) {
  //   window.botpressWebChat.sendPayload({
  //     type: 'trigger',
  //     payload: {
  //       name: Name,
  //       content: Content,
  //     },
  //   })
  // }

  // sendData('upload_file', 'text')
  </script>



</body>
</html>

